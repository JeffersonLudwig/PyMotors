<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyMotors</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="logo">üèéÔ∏è PyMotors</div>
        
        <div class="user-controls">
            <button id="toggle-theme" class="btn-icon"><span class="material-icons">dark_mode</span></button>
            
            {% if current_user.is_authenticated %}
                <span class="welcome">Ol√°, {{ current_user.nome }} ({{ current_user.tipo }})</span>
                
                {% if current_user.tipo == 'vendedor' %}
                    <button onclick="toggleForm()" class="btn-primary">+ Anunciar</button>
                {% endif %}
                
                <a href="/logout" class="btn-secondary">Sair</a>
            {% else %}
                <a href="/login" class="btn-primary">Entrar</a>
                <a href="/registro" class="btn-secondary">Cadastrar</a>
            {% endif %}
        </div>
    </header>

    <div class="container">
        <div id="form-anuncio" class="card-form hidden">
            <h3>Novo An√∫ncio</h3>
            <form action="/anunciar" method="POST" enctype="multipart/form-data">
                <input type="text" name="modelo" placeholder="Modelo" required>
                <div class="row">
                    <input type="text" name="marca" placeholder="Marca" required>
                    <input type="number" name="ano" placeholder="Ano" required>
                </div>
                <input type="number" step="0.01" name="preco" placeholder="Pre√ßo (R$)" required>
                <input type="file" name="foto" accept="image/*">
                <button type="submit" class="btn-save">Publicar</button>
            </form>
        </div>

        <div class="grid-carros">
            {% for carro in carros %}
            <div class="card-carro">
                <img src="{{ url_for('static', filename='uploads/' + carro.imagem) }}" onerror="this.src='https://via.placeholder.com/300?text=Carro'">
                <div class="detalhes">
                    <h4>{{ carro.modelo }}</h4>
                    <p class="marca">{{ carro.marca }} ‚Ä¢ {{ carro.ano }}</p>
                    <p class="preco">R$ {{ "%.2f"|format(carro.preco) }}</p>
                    
                    {% if current_user.is_authenticated and current_user.id == carro.vendedor_id %}
                        <a href="/deletar/{{ carro.id }}" class="btn-delete">Excluir An√∫ncio</a>
                    {% else %}
                        <button class="btn-buy">Tenho Interesse</button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function toggleForm() {
            document.getElementById('form-anuncio').classList.toggle('hidden');
        }

        // Script do Dark Mode
        const toggleBtn = document.getElementById('toggle-theme');
        const icon = toggleBtn.querySelector('span');
        const body = document.body;

        if (localStorage.getItem('theme') === 'dark') {
            body.classList.add('dark-mode');
            icon.textContent = 'light_mode';
        }

        toggleBtn.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            if (body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
                icon.textContent = 'light_mode';
            } else {
                localStorage.setItem('theme', 'light');
                icon.textContent = 'dark_mode';
            }
        });
    </script>
</body>
</html>